ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"current.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "Controller/Sensors/current.c"
  20              		.section	.text.HAL_ADCEx_InjectedConvCpltCallback,"ax",%progbits
  21              		.align	1
  22              		.global	HAL_ADCEx_InjectedConvCpltCallback
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	HAL_ADCEx_InjectedConvCpltCallback:
  28              	.LVL0:
  29              	.LFB239:
   1:Controller/Sensors/current.c **** #include "./current.h"
   2:Controller/Sensors/current.c **** 
   3:Controller/Sensors/current.c **** #include <string.h>
   4:Controller/Sensors/current.c **** 
   5:Controller/Sensors/current.c **** #include "adc.h"
   6:Controller/Sensors/current.c **** #include "dev_usart.h"
   7:Controller/Sensors/current.c **** #include "stm32f4xx_hal_adc_ex.h"
   8:Controller/Sensors/current.c **** 
   9:Controller/Sensors/current.c **** #define ADC_RESOLUTION 4096.0f
  10:Controller/Sensors/current.c **** #define ADC_VOLTAGE_REF 3.3f
  11:Controller/Sensors/current.c **** #define SHUNT_RESISTANCE 0.005f
  12:Controller/Sensors/current.c **** #define AMP_GAIN 40.0f
  13:Controller/Sensors/current.c **** 
  14:Controller/Sensors/current.c **** static float g_ia_offset = 0.0f;
  15:Controller/Sensors/current.c **** static float g_ib_offset = 0.0f;
  16:Controller/Sensors/current.c **** static float g_ic_offset = 0.0f;
  17:Controller/Sensors/current.c **** static float g_gain = 0.0f;
  18:Controller/Sensors/current.c **** static float g_ia = 0.0f;
  19:Controller/Sensors/current.c **** static float g_ib = 0.0f;
  20:Controller/Sensors/current.c **** static float g_ic = 0.0f;
  21:Controller/Sensors/current.c **** 
  22:Controller/Sensors/current.c **** static uint8_t g_adc1_state = 0;
  23:Controller/Sensors/current.c **** static uint8_t g_adc2_state = 0;
  24:Controller/Sensors/current.c **** static uint8_t g_adc3_state = 0;
  25:Controller/Sensors/current.c **** 
  26:Controller/Sensors/current.c **** static float g_current[3] = {0.0f, 0.0f, 0.0f};
  27:Controller/Sensors/current.c **** 
  28:Controller/Sensors/current.c **** static uint8_t g_tmp[16] = {0, 0, 0, 0, 0, 0, 0,    0,
  29:Controller/Sensors/current.c ****                             0, 0, 0, 0, 0, 0, 0x80, 0x7f};
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 2


  30:Controller/Sensors/current.c **** 
  31:Controller/Sensors/current.c **** void HAL_ADCEx_InjectedConvCpltCallback(ADC_HandleTypeDef* hadc) {
  30              		.loc 1 31 66 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		.loc 1 31 66 is_stmt 0 view .LVU1
  35 0000 08B5     		push	{r3, lr}
  36              		.cfi_def_cfa_offset 8
  37              		.cfi_offset 3, -8
  38              		.cfi_offset 14, -4
  32:Controller/Sensors/current.c ****   static int16_t adc1_cnt = 0;
  39              		.loc 1 32 3 is_stmt 1 view .LVU2
  33:Controller/Sensors/current.c ****   static int16_t adc2_cnt = 0;
  40              		.loc 1 33 3 view .LVU3
  34:Controller/Sensors/current.c ****   static int16_t adc3_cnd = 0;
  41              		.loc 1 34 3 view .LVU4
  35:Controller/Sensors/current.c **** 
  36:Controller/Sensors/current.c ****   if (ADC1 == hadc->Instance) {
  42              		.loc 1 36 3 view .LVU5
  43              		.loc 1 36 19 is_stmt 0 view .LVU6
  44 0002 0368     		ldr	r3, [r0]
  45              		.loc 1 36 6 view .LVU7
  46 0004 5B4A     		ldr	r2, .L14
  47 0006 9342     		cmp	r3, r2
  48 0008 13D0     		beq	.L10
  37:Controller/Sensors/current.c ****     float adc1_in0 = hadc1.Instance->JDR1;
  38:Controller/Sensors/current.c ****     if (0 == g_adc1_state) {
  39:Controller/Sensors/current.c ****       g_ia_offset += adc1_in0;
  40:Controller/Sensors/current.c ****       if (100 == ++adc1_cnt) {
  41:Controller/Sensors/current.c ****         g_ia_offset /= 100.0f;
  42:Controller/Sensors/current.c ****         g_adc1_state = 1;
  43:Controller/Sensors/current.c ****       }
  44:Controller/Sensors/current.c ****     } else {
  45:Controller/Sensors/current.c ****       g_ia = (adc1_in0 - g_ia_offset) * g_gain;
  46:Controller/Sensors/current.c ****     }
  47:Controller/Sensors/current.c ****   } else if (ADC2 == hadc->Instance) {
  49              		.loc 1 47 10 is_stmt 1 view .LVU8
  50              		.loc 1 47 13 is_stmt 0 view .LVU9
  51 000a 5B4A     		ldr	r2, .L14+4
  52 000c 9342     		cmp	r3, r2
  53 000e 40D0     		beq	.L11
  48:Controller/Sensors/current.c ****     float adc2_in1 = hadc2.Instance->JDR1;
  49:Controller/Sensors/current.c ****     if (0 == g_adc2_state) {
  50:Controller/Sensors/current.c ****       g_ib_offset += adc2_in1;
  51:Controller/Sensors/current.c ****       if (100 == ++adc2_cnt) {
  52:Controller/Sensors/current.c ****         g_ib_offset /= 100.0f;
  53:Controller/Sensors/current.c ****         g_adc2_state = 1;
  54:Controller/Sensors/current.c ****       }
  55:Controller/Sensors/current.c ****     } else {
  56:Controller/Sensors/current.c ****       g_ib = (adc2_in1 - g_ib_offset) * g_gain;
  57:Controller/Sensors/current.c ****     }
  58:Controller/Sensors/current.c ****   } else if (ADC3 == hadc->Instance) {
  54              		.loc 1 58 10 is_stmt 1 view .LVU10
  55              		.loc 1 58 13 is_stmt 0 view .LVU11
  56 0010 5A4A     		ldr	r2, .L14+8
  57 0012 9342     		cmp	r3, r2
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 3


  58 0014 6DD0     		beq	.L12
  59              	.L4:
  59:Controller/Sensors/current.c ****     float adc3_in2 = hadc3.Instance->JDR1;
  60:Controller/Sensors/current.c ****     if (0 == g_adc3_state) {
  61:Controller/Sensors/current.c ****       g_ic_offset += adc3_in2;
  62:Controller/Sensors/current.c ****       if (100 == ++adc3_cnd) {
  63:Controller/Sensors/current.c ****         g_ic_offset /= 100.0f;
  64:Controller/Sensors/current.c ****         g_adc3_state = 1;
  65:Controller/Sensors/current.c ****       }
  66:Controller/Sensors/current.c ****     } else {
  67:Controller/Sensors/current.c ****       g_ic = (adc3_in2 - g_ic_offset) * g_gain;
  68:Controller/Sensors/current.c ****     }
  69:Controller/Sensors/current.c ****   }
  70:Controller/Sensors/current.c **** 
  71:Controller/Sensors/current.c ****   if (!g_adc1_state || !g_adc2_state || !g_adc3_state) {
  60              		.loc 1 71 3 is_stmt 1 view .LVU12
  61              		.loc 1 71 7 is_stmt 0 view .LVU13
  62 0016 5A4A     		ldr	r2, .L14+12
  63 0018 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  64              		.loc 1 71 6 view .LVU14
  65 001a 4AB1     		cbz	r2, .L1
  66              		.loc 1 71 24 discriminator 1 view .LVU15
  67 001c 594A     		ldr	r2, .L14+16
  68 001e 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  69              		.loc 1 71 21 discriminator 1 view .LVU16
  70 0020 32B1     		cbz	r2, .L1
  71              		.loc 1 71 41 discriminator 2 view .LVU17
  72 0022 594A     		ldr	r2, .L14+20
  73 0024 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  74              		.loc 1 71 38 discriminator 2 view .LVU18
  75 0026 1AB1     		cbz	r2, .L1
  72:Controller/Sensors/current.c ****     return;
  73:Controller/Sensors/current.c ****   }
  74:Controller/Sensors/current.c **** 
  75:Controller/Sensors/current.c ****   if (ADC1 == hadc->Instance) {
  76              		.loc 1 75 3 is_stmt 1 view .LVU19
  77              		.loc 1 75 6 is_stmt 0 view .LVU20
  78 0028 524A     		ldr	r2, .L14
  79 002a 9342     		cmp	r3, r2
  80 002c 00F09280 		beq	.L13
  81              	.LVL1:
  82              	.L1:
  76:Controller/Sensors/current.c ****     HAL_GPIO_TogglePin(GPIOC, GPIO_PIN_13);
  77:Controller/Sensors/current.c ****     // 在ADC1中触发FOC控制
  78:Controller/Sensors/current.c ****     g_current[0] = g_ia;
  79:Controller/Sensors/current.c ****     g_current[1] = g_ib;
  80:Controller/Sensors/current.c ****     g_current[2] = g_ic;
  81:Controller/Sensors/current.c **** 
  82:Controller/Sensors/current.c ****     // memcpy(g_tmp, g_current, sizeof(g_current));
  83:Controller/Sensors/current.c ****     // dev_usart_write(g_tmp, sizeof(g_tmp));
  84:Controller/Sensors/current.c ****   }
  85:Controller/Sensors/current.c **** }
  83              		.loc 1 85 1 view .LVU21
  84 0030 08BD     		pop	{r3, pc}
  85              	.LVL2:
  86              	.L10:
  87              	.LBB2:
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 4


  37:Controller/Sensors/current.c ****     if (0 == g_adc1_state) {
  88              		.loc 1 37 5 is_stmt 1 view .LVU22
  37:Controller/Sensors/current.c ****     if (0 == g_adc1_state) {
  89              		.loc 1 37 27 is_stmt 0 view .LVU23
  90 0032 564A     		ldr	r2, .L14+24
  91 0034 1268     		ldr	r2, [r2]
  37:Controller/Sensors/current.c ****     if (0 == g_adc1_state) {
  92              		.loc 1 37 36 view .LVU24
  93 0036 D2ED0F7A 		vldr.32	s15, [r2, #60]	@ int
  37:Controller/Sensors/current.c ****     if (0 == g_adc1_state) {
  94              		.loc 1 37 11 view .LVU25
  95 003a F8EE677A 		vcvt.f32.u32	s15, s15
  96              	.LVL3:
  38:Controller/Sensors/current.c ****       g_ia_offset += adc1_in0;
  97              		.loc 1 38 5 is_stmt 1 view .LVU26
  38:Controller/Sensors/current.c ****       g_ia_offset += adc1_in0;
  98              		.loc 1 38 11 is_stmt 0 view .LVU27
  99 003e 504A     		ldr	r2, .L14+12
 100 0040 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  38:Controller/Sensors/current.c ****       g_ia_offset += adc1_in0;
 101              		.loc 1 38 8 view .LVU28
 102 0042 C2B9     		cbnz	r2, .L3
  39:Controller/Sensors/current.c ****       if (100 == ++adc1_cnt) {
 103              		.loc 1 39 7 is_stmt 1 view .LVU29
  39:Controller/Sensors/current.c ****       if (100 == ++adc1_cnt) {
 104              		.loc 1 39 19 is_stmt 0 view .LVU30
 105 0044 524A     		ldr	r2, .L14+28
 106 0046 92ED007A 		vldr.32	s14, [r2]
 107 004a 77EE877A 		vadd.f32	s15, s15, s14
 108              	.LVL4:
  39:Controller/Sensors/current.c ****       if (100 == ++adc1_cnt) {
 109              		.loc 1 39 19 view .LVU31
 110 004e C2ED007A 		vstr.32	s15, [r2]
  40:Controller/Sensors/current.c ****         g_ia_offset /= 100.0f;
 111              		.loc 1 40 7 is_stmt 1 view .LVU32
  40:Controller/Sensors/current.c ****         g_ia_offset /= 100.0f;
 112              		.loc 1 40 18 is_stmt 0 view .LVU33
 113 0052 5049     		ldr	r1, .L14+32
 114 0054 0A88     		ldrh	r2, [r1]
 115 0056 0132     		adds	r2, r2, #1
 116 0058 12B2     		sxth	r2, r2
  40:Controller/Sensors/current.c ****         g_ia_offset /= 100.0f;
 117              		.loc 1 40 10 view .LVU34
 118 005a 0A80     		strh	r2, [r1]	@ movhi
 119 005c 642A     		cmp	r2, #100
 120 005e DAD1     		bne	.L4
  41:Controller/Sensors/current.c ****         g_adc1_state = 1;
 121              		.loc 1 41 9 is_stmt 1 view .LVU35
  41:Controller/Sensors/current.c ****         g_adc1_state = 1;
 122              		.loc 1 41 21 is_stmt 0 view .LVU36
 123 0060 DFED4D6A 		vldr.32	s13, .L14+36
 124 0064 87EEA67A 		vdiv.f32	s14, s15, s13
 125 0068 494A     		ldr	r2, .L14+28
 126 006a 82ED007A 		vstr.32	s14, [r2]
  42:Controller/Sensors/current.c ****       }
 127              		.loc 1 42 9 is_stmt 1 view .LVU37
  42:Controller/Sensors/current.c ****       }
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 5


 128              		.loc 1 42 22 is_stmt 0 view .LVU38
 129 006e 444A     		ldr	r2, .L14+12
 130 0070 0121     		movs	r1, #1
 131 0072 1170     		strb	r1, [r2]
 132 0074 CFE7     		b	.L4
 133              	.LVL5:
 134              	.L3:
  45:Controller/Sensors/current.c ****     }
 135              		.loc 1 45 7 is_stmt 1 view .LVU39
  45:Controller/Sensors/current.c ****     }
 136              		.loc 1 45 24 is_stmt 0 view .LVU40
 137 0076 464A     		ldr	r2, .L14+28
 138 0078 92ED007A 		vldr.32	s14, [r2]
 139 007c 77EEC77A 		vsub.f32	s15, s15, s14
 140              	.LVL6:
  45:Controller/Sensors/current.c ****     }
 141              		.loc 1 45 39 view .LVU41
 142 0080 464A     		ldr	r2, .L14+40
 143 0082 92ED007A 		vldr.32	s14, [r2]
 144 0086 67EE877A 		vmul.f32	s15, s15, s14
  45:Controller/Sensors/current.c ****     }
 145              		.loc 1 45 12 view .LVU42
 146 008a 454A     		ldr	r2, .L14+44
 147 008c C2ED007A 		vstr.32	s15, [r2]
 148 0090 C1E7     		b	.L4
 149              	.LVL7:
 150              	.L11:
  45:Controller/Sensors/current.c ****     }
 151              		.loc 1 45 12 view .LVU43
 152              	.LBE2:
 153              	.LBB3:
  48:Controller/Sensors/current.c ****     if (0 == g_adc2_state) {
 154              		.loc 1 48 5 is_stmt 1 view .LVU44
  48:Controller/Sensors/current.c ****     if (0 == g_adc2_state) {
 155              		.loc 1 48 27 is_stmt 0 view .LVU45
 156 0092 444A     		ldr	r2, .L14+48
 157 0094 1268     		ldr	r2, [r2]
  48:Controller/Sensors/current.c ****     if (0 == g_adc2_state) {
 158              		.loc 1 48 36 view .LVU46
 159 0096 D2ED0F7A 		vldr.32	s15, [r2, #60]	@ int
  48:Controller/Sensors/current.c ****     if (0 == g_adc2_state) {
 160              		.loc 1 48 11 view .LVU47
 161 009a F8EE677A 		vcvt.f32.u32	s15, s15
 162              	.LVL8:
  49:Controller/Sensors/current.c ****       g_ib_offset += adc2_in1;
 163              		.loc 1 49 5 is_stmt 1 view .LVU48
  49:Controller/Sensors/current.c ****       g_ib_offset += adc2_in1;
 164              		.loc 1 49 11 is_stmt 0 view .LVU49
 165 009e 394A     		ldr	r2, .L14+16
 166 00a0 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  49:Controller/Sensors/current.c ****       g_ib_offset += adc2_in1;
 167              		.loc 1 49 8 view .LVU50
 168 00a2 C2B9     		cbnz	r2, .L6
  50:Controller/Sensors/current.c ****       if (100 == ++adc2_cnt) {
 169              		.loc 1 50 7 is_stmt 1 view .LVU51
  50:Controller/Sensors/current.c ****       if (100 == ++adc2_cnt) {
 170              		.loc 1 50 19 is_stmt 0 view .LVU52
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 6


 171 00a4 404A     		ldr	r2, .L14+52
 172 00a6 92ED007A 		vldr.32	s14, [r2]
 173 00aa 77EE877A 		vadd.f32	s15, s15, s14
 174              	.LVL9:
  50:Controller/Sensors/current.c ****       if (100 == ++adc2_cnt) {
 175              		.loc 1 50 19 view .LVU53
 176 00ae C2ED007A 		vstr.32	s15, [r2]
  51:Controller/Sensors/current.c ****         g_ib_offset /= 100.0f;
 177              		.loc 1 51 7 is_stmt 1 view .LVU54
  51:Controller/Sensors/current.c ****         g_ib_offset /= 100.0f;
 178              		.loc 1 51 18 is_stmt 0 view .LVU55
 179 00b2 3E49     		ldr	r1, .L14+56
 180 00b4 0A88     		ldrh	r2, [r1]
 181 00b6 0132     		adds	r2, r2, #1
 182 00b8 12B2     		sxth	r2, r2
  51:Controller/Sensors/current.c ****         g_ib_offset /= 100.0f;
 183              		.loc 1 51 10 view .LVU56
 184 00ba 0A80     		strh	r2, [r1]	@ movhi
 185 00bc 642A     		cmp	r2, #100
 186 00be AAD1     		bne	.L4
  52:Controller/Sensors/current.c ****         g_adc2_state = 1;
 187              		.loc 1 52 9 is_stmt 1 view .LVU57
  52:Controller/Sensors/current.c ****         g_adc2_state = 1;
 188              		.loc 1 52 21 is_stmt 0 view .LVU58
 189 00c0 DFED356A 		vldr.32	s13, .L14+36
 190 00c4 87EEA67A 		vdiv.f32	s14, s15, s13
 191 00c8 374A     		ldr	r2, .L14+52
 192 00ca 82ED007A 		vstr.32	s14, [r2]
  53:Controller/Sensors/current.c ****       }
 193              		.loc 1 53 9 is_stmt 1 view .LVU59
  53:Controller/Sensors/current.c ****       }
 194              		.loc 1 53 22 is_stmt 0 view .LVU60
 195 00ce 2D4A     		ldr	r2, .L14+16
 196 00d0 0121     		movs	r1, #1
 197 00d2 1170     		strb	r1, [r2]
 198 00d4 9FE7     		b	.L4
 199              	.LVL10:
 200              	.L6:
  56:Controller/Sensors/current.c ****     }
 201              		.loc 1 56 7 is_stmt 1 view .LVU61
  56:Controller/Sensors/current.c ****     }
 202              		.loc 1 56 24 is_stmt 0 view .LVU62
 203 00d6 344A     		ldr	r2, .L14+52
 204 00d8 92ED007A 		vldr.32	s14, [r2]
 205 00dc 77EEC77A 		vsub.f32	s15, s15, s14
 206              	.LVL11:
  56:Controller/Sensors/current.c ****     }
 207              		.loc 1 56 39 view .LVU63
 208 00e0 2E4A     		ldr	r2, .L14+40
 209 00e2 92ED007A 		vldr.32	s14, [r2]
 210 00e6 67EE877A 		vmul.f32	s15, s15, s14
  56:Controller/Sensors/current.c ****     }
 211              		.loc 1 56 12 view .LVU64
 212 00ea 314A     		ldr	r2, .L14+60
 213 00ec C2ED007A 		vstr.32	s15, [r2]
 214 00f0 91E7     		b	.L4
 215              	.LVL12:
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 7


 216              	.L12:
  56:Controller/Sensors/current.c ****     }
 217              		.loc 1 56 12 view .LVU65
 218              	.LBE3:
 219              	.LBB4:
  59:Controller/Sensors/current.c ****     if (0 == g_adc3_state) {
 220              		.loc 1 59 5 is_stmt 1 view .LVU66
  59:Controller/Sensors/current.c ****     if (0 == g_adc3_state) {
 221              		.loc 1 59 27 is_stmt 0 view .LVU67
 222 00f2 304A     		ldr	r2, .L14+64
 223 00f4 1268     		ldr	r2, [r2]
  59:Controller/Sensors/current.c ****     if (0 == g_adc3_state) {
 224              		.loc 1 59 36 view .LVU68
 225 00f6 D2ED0F7A 		vldr.32	s15, [r2, #60]	@ int
  59:Controller/Sensors/current.c ****     if (0 == g_adc3_state) {
 226              		.loc 1 59 11 view .LVU69
 227 00fa F8EE677A 		vcvt.f32.u32	s15, s15
 228              	.LVL13:
  60:Controller/Sensors/current.c ****       g_ic_offset += adc3_in2;
 229              		.loc 1 60 5 is_stmt 1 view .LVU70
  60:Controller/Sensors/current.c ****       g_ic_offset += adc3_in2;
 230              		.loc 1 60 11 is_stmt 0 view .LVU71
 231 00fe 224A     		ldr	r2, .L14+20
 232 0100 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  60:Controller/Sensors/current.c ****       g_ic_offset += adc3_in2;
 233              		.loc 1 60 8 view .LVU72
 234 0102 CAB9     		cbnz	r2, .L7
  61:Controller/Sensors/current.c ****       if (100 == ++adc3_cnd) {
 235              		.loc 1 61 7 is_stmt 1 view .LVU73
  61:Controller/Sensors/current.c ****       if (100 == ++adc3_cnd) {
 236              		.loc 1 61 19 is_stmt 0 view .LVU74
 237 0104 2C4A     		ldr	r2, .L14+68
 238 0106 92ED007A 		vldr.32	s14, [r2]
 239 010a 77EE877A 		vadd.f32	s15, s15, s14
 240              	.LVL14:
  61:Controller/Sensors/current.c ****       if (100 == ++adc3_cnd) {
 241              		.loc 1 61 19 view .LVU75
 242 010e C2ED007A 		vstr.32	s15, [r2]
  62:Controller/Sensors/current.c ****         g_ic_offset /= 100.0f;
 243              		.loc 1 62 7 is_stmt 1 view .LVU76
  62:Controller/Sensors/current.c ****         g_ic_offset /= 100.0f;
 244              		.loc 1 62 18 is_stmt 0 view .LVU77
 245 0112 2A49     		ldr	r1, .L14+72
 246 0114 0A88     		ldrh	r2, [r1]
 247 0116 0132     		adds	r2, r2, #1
 248 0118 12B2     		sxth	r2, r2
  62:Controller/Sensors/current.c ****         g_ic_offset /= 100.0f;
 249              		.loc 1 62 10 view .LVU78
 250 011a 0A80     		strh	r2, [r1]	@ movhi
 251 011c 642A     		cmp	r2, #100
 252 011e 7FF47AAF 		bne	.L4
  63:Controller/Sensors/current.c ****         g_adc3_state = 1;
 253              		.loc 1 63 9 is_stmt 1 view .LVU79
  63:Controller/Sensors/current.c ****         g_adc3_state = 1;
 254              		.loc 1 63 21 is_stmt 0 view .LVU80
 255 0122 DFED1D6A 		vldr.32	s13, .L14+36
 256 0126 87EEA67A 		vdiv.f32	s14, s15, s13
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 8


 257 012a 234A     		ldr	r2, .L14+68
 258 012c 82ED007A 		vstr.32	s14, [r2]
  64:Controller/Sensors/current.c ****       }
 259              		.loc 1 64 9 is_stmt 1 view .LVU81
  64:Controller/Sensors/current.c ****       }
 260              		.loc 1 64 22 is_stmt 0 view .LVU82
 261 0130 154A     		ldr	r2, .L14+20
 262 0132 0121     		movs	r1, #1
 263 0134 1170     		strb	r1, [r2]
 264 0136 6EE7     		b	.L4
 265              	.LVL15:
 266              	.L7:
  67:Controller/Sensors/current.c ****     }
 267              		.loc 1 67 7 is_stmt 1 view .LVU83
  67:Controller/Sensors/current.c ****     }
 268              		.loc 1 67 24 is_stmt 0 view .LVU84
 269 0138 1F4A     		ldr	r2, .L14+68
 270 013a 92ED007A 		vldr.32	s14, [r2]
 271 013e 77EEC77A 		vsub.f32	s15, s15, s14
 272              	.LVL16:
  67:Controller/Sensors/current.c ****     }
 273              		.loc 1 67 39 view .LVU85
 274 0142 164A     		ldr	r2, .L14+40
 275 0144 92ED007A 		vldr.32	s14, [r2]
 276 0148 67EE877A 		vmul.f32	s15, s15, s14
  67:Controller/Sensors/current.c ****     }
 277              		.loc 1 67 12 view .LVU86
 278 014c 1C4A     		ldr	r2, .L14+76
 279 014e C2ED007A 		vstr.32	s15, [r2]
 280 0152 60E7     		b	.L4
 281              	.LVL17:
 282              	.L13:
  67:Controller/Sensors/current.c ****     }
 283              		.loc 1 67 12 view .LVU87
 284              	.LBE4:
  76:Controller/Sensors/current.c ****     // 在ADC1中触发FOC控制
 285              		.loc 1 76 5 is_stmt 1 view .LVU88
 286 0154 4FF40051 		mov	r1, #8192
 287 0158 1A48     		ldr	r0, .L14+80
 288              	.LVL18:
  76:Controller/Sensors/current.c ****     // 在ADC1中触发FOC控制
 289              		.loc 1 76 5 is_stmt 0 view .LVU89
 290 015a FFF7FEFF 		bl	HAL_GPIO_TogglePin
 291              	.LVL19:
  78:Controller/Sensors/current.c ****     g_current[1] = g_ib;
 292              		.loc 1 78 5 is_stmt 1 view .LVU90
  78:Controller/Sensors/current.c ****     g_current[1] = g_ib;
 293              		.loc 1 78 18 is_stmt 0 view .LVU91
 294 015e 1A4B     		ldr	r3, .L14+84
 295 0160 0F4A     		ldr	r2, .L14+44
 296 0162 1268     		ldr	r2, [r2]	@ float
 297 0164 1A60     		str	r2, [r3]	@ float
  79:Controller/Sensors/current.c ****     g_current[2] = g_ic;
 298              		.loc 1 79 5 is_stmt 1 view .LVU92
  79:Controller/Sensors/current.c ****     g_current[2] = g_ic;
 299              		.loc 1 79 18 is_stmt 0 view .LVU93
 300 0166 124A     		ldr	r2, .L14+60
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 9


 301 0168 1268     		ldr	r2, [r2]	@ float
 302 016a 5A60     		str	r2, [r3, #4]	@ float
  80:Controller/Sensors/current.c **** 
 303              		.loc 1 80 5 is_stmt 1 view .LVU94
  80:Controller/Sensors/current.c **** 
 304              		.loc 1 80 18 is_stmt 0 view .LVU95
 305 016c 144A     		ldr	r2, .L14+76
 306 016e 1268     		ldr	r2, [r2]	@ float
 307 0170 9A60     		str	r2, [r3, #8]	@ float
 308 0172 5DE7     		b	.L1
 309              	.L15:
 310              		.align	2
 311              	.L14:
 312 0174 00200140 		.word	1073815552
 313 0178 00210140 		.word	1073815808
 314 017c 00220140 		.word	1073816064
 315 0180 00000000 		.word	g_adc1_state
 316 0184 00000000 		.word	g_adc2_state
 317 0188 00000000 		.word	g_adc3_state
 318 018c 00000000 		.word	hadc1
 319 0190 00000000 		.word	g_ia_offset
 320 0194 00000000 		.word	adc1_cnt.2
 321 0198 0000C842 		.word	1120403456
 322 019c 00000000 		.word	g_gain
 323 01a0 00000000 		.word	g_ia
 324 01a4 00000000 		.word	hadc2
 325 01a8 00000000 		.word	g_ib_offset
 326 01ac 00000000 		.word	adc2_cnt.1
 327 01b0 00000000 		.word	g_ib
 328 01b4 00000000 		.word	hadc3
 329 01b8 00000000 		.word	g_ic_offset
 330 01bc 00000000 		.word	adc3_cnd.0
 331 01c0 00000000 		.word	g_ic
 332 01c4 00080240 		.word	1073874944
 333 01c8 00000000 		.word	g_current
 334              		.cfi_endproc
 335              	.LFE239:
 337              		.section	.text.current_init,"ax",%progbits
 338              		.align	1
 339              		.global	current_init
 340              		.syntax unified
 341              		.thumb
 342              		.thumb_func
 344              	current_init:
 345              	.LFB240:
  86:Controller/Sensors/current.c **** 
  87:Controller/Sensors/current.c **** void current_init(void) {
 346              		.loc 1 87 25 is_stmt 1 view -0
 347              		.cfi_startproc
 348              		@ args = 0, pretend = 0, frame = 0
 349              		@ frame_needed = 0, uses_anonymous_args = 0
 350 0000 08B5     		push	{r3, lr}
 351              		.cfi_def_cfa_offset 8
 352              		.cfi_offset 3, -8
 353              		.cfi_offset 14, -4
  88:Controller/Sensors/current.c ****   // 计算增益(计算出电压值 除以 采样电阻值 除以 放大倍数)
  89:Controller/Sensors/current.c ****   g_gain = (ADC_VOLTAGE_REF / ADC_RESOLUTION) / (SHUNT_RESISTANCE * AMP_GAIN);
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 10


 354              		.loc 1 89 3 view .LVU97
 355              		.loc 1 89 10 is_stmt 0 view .LVU98
 356 0002 064B     		ldr	r3, .L18
 357 0004 064A     		ldr	r2, .L18+4
 358 0006 1A60     		str	r2, [r3]	@ float
  90:Controller/Sensors/current.c **** 
  91:Controller/Sensors/current.c ****   HAL_ADCEx_InjectedStart_IT(&hadc1);
 359              		.loc 1 91 3 is_stmt 1 view .LVU99
 360 0008 0648     		ldr	r0, .L18+8
 361 000a FFF7FEFF 		bl	HAL_ADCEx_InjectedStart_IT
 362              	.LVL20:
  92:Controller/Sensors/current.c ****   HAL_ADCEx_InjectedStart_IT(&hadc2);
 363              		.loc 1 92 3 view .LVU100
 364 000e 0648     		ldr	r0, .L18+12
 365 0010 FFF7FEFF 		bl	HAL_ADCEx_InjectedStart_IT
 366              	.LVL21:
  93:Controller/Sensors/current.c ****   HAL_ADCEx_InjectedStart_IT(&hadc3);
 367              		.loc 1 93 3 view .LVU101
 368 0014 0548     		ldr	r0, .L18+16
 369 0016 FFF7FEFF 		bl	HAL_ADCEx_InjectedStart_IT
 370              	.LVL22:
  94:Controller/Sensors/current.c **** }
 371              		.loc 1 94 1 is_stmt 0 view .LVU102
 372 001a 08BD     		pop	{r3, pc}
 373              	.L19:
 374              		.align	2
 375              	.L18:
 376 001c 00000000 		.word	g_gain
 377 0020 0000843B 		.word	998506496
 378 0024 00000000 		.word	hadc1
 379 0028 00000000 		.word	hadc2
 380 002c 00000000 		.word	hadc3
 381              		.cfi_endproc
 382              	.LFE240:
 384              		.section	.text.current_get,"ax",%progbits
 385              		.align	1
 386              		.global	current_get
 387              		.syntax unified
 388              		.thumb
 389              		.thumb_func
 391              	current_get:
 392              	.LVL23:
 393              	.LFB241:
  95:Controller/Sensors/current.c **** 
  96:Controller/Sensors/current.c **** int current_get(float* arr) {
 394              		.loc 1 96 29 is_stmt 1 view -0
 395              		.cfi_startproc
 396              		@ args = 0, pretend = 0, frame = 0
 397              		@ frame_needed = 0, uses_anonymous_args = 0
 398              		@ link register save eliminated.
  97:Controller/Sensors/current.c ****   if (!g_adc1_state || !g_adc2_state || !g_adc3_state) {
 399              		.loc 1 97 3 view .LVU104
 400              		.loc 1 97 7 is_stmt 0 view .LVU105
 401 0000 0E4A     		ldr	r2, .L29
 402 0002 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
 403              		.loc 1 97 6 view .LVU106
 404 0004 82B1     		cbz	r2, .L22
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 11


 405 0006 0346     		mov	r3, r0
 406              		.loc 1 97 24 discriminator 1 view .LVU107
 407 0008 0D4A     		ldr	r2, .L29+4
 408 000a 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
 409              		.loc 1 97 21 discriminator 1 view .LVU108
 410 000c 7AB1     		cbz	r2, .L23
 411              		.loc 1 97 41 discriminator 2 view .LVU109
 412 000e 0D4A     		ldr	r2, .L29+8
 413 0010 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
 414              		.loc 1 97 38 discriminator 2 view .LVU110
 415 0012 7AB1     		cbz	r2, .L24
  96:Controller/Sensors/current.c ****   if (!g_adc1_state || !g_adc2_state || !g_adc3_state) {
 416              		.loc 1 96 29 view .LVU111
 417 0014 10B4     		push	{r4}
 418              		.cfi_def_cfa_offset 4
 419              		.cfi_offset 4, -4
  98:Controller/Sensors/current.c ****     return -1;
  99:Controller/Sensors/current.c ****   }
 100:Controller/Sensors/current.c ****   memcpy(arr, g_current, sizeof(g_current));
 420              		.loc 1 100 3 is_stmt 1 view .LVU112
 421 0016 0C4C     		ldr	r4, .L29+12
 422 0018 07CC     		ldmia	r4!, {r0, r1, r2}
 423              	.LVL24:
 424              		.loc 1 100 3 is_stmt 0 view .LVU113
 425 001a 1860     		str	r0, [r3]	@ unaligned
 426 001c 5960     		str	r1, [r3, #4]	@ unaligned
 427 001e 9A60     		str	r2, [r3, #8]	@ unaligned
 101:Controller/Sensors/current.c ****   return 0;
 428              		.loc 1 101 3 is_stmt 1 view .LVU114
 429              		.loc 1 101 10 is_stmt 0 view .LVU115
 430 0020 0020     		movs	r0, #0
 102:Controller/Sensors/current.c **** }...
 431              		.loc 1 102 1 view .LVU116
 432 0022 5DF8044B 		ldr	r4, [sp], #4
 433              		.cfi_restore 4
 434              		.cfi_def_cfa_offset 0
 435 0026 7047     		bx	lr
 436              	.LVL25:
 437              	.L22:
  98:Controller/Sensors/current.c ****     return -1;
 438              		.loc 1 98 12 view .LVU117
 439 0028 4FF0FF30 		mov	r0, #-1
 440              	.LVL26:
  98:Controller/Sensors/current.c ****     return -1;
 441              		.loc 1 98 12 view .LVU118
 442 002c 7047     		bx	lr
 443              	.LVL27:
 444              	.L23:
  98:Controller/Sensors/current.c ****     return -1;
 445              		.loc 1 98 12 view .LVU119
 446 002e 4FF0FF30 		mov	r0, #-1
 447              	.LVL28:
  98:Controller/Sensors/current.c ****     return -1;
 448              		.loc 1 98 12 view .LVU120
 449 0032 7047     		bx	lr
 450              	.LVL29:
 451              	.L24:
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 12


  98:Controller/Sensors/current.c ****     return -1;
 452              		.loc 1 98 12 view .LVU121
 453 0034 4FF0FF30 		mov	r0, #-1
 454              	.LVL30:
 455              		.loc 1 102 1 view .LVU122
 456 0038 7047     		bx	lr
 457              	.L30:
 458 003a 00BF     		.align	2
 459              	.L29:
 460 003c 00000000 		.word	g_adc1_state
 461 0040 00000000 		.word	g_adc2_state
 462 0044 00000000 		.word	g_adc3_state
 463 0048 00000000 		.word	g_current
 464              		.cfi_endproc
 465              	.LFE241:
 467              		.section	.bss.adc3_cnd.0,"aw",%nobits
 468              		.align	1
 471              	adc3_cnd.0:
 472 0000 0000     		.space	2
 473              		.section	.bss.adc2_cnt.1,"aw",%nobits
 474              		.align	1
 477              	adc2_cnt.1:
 478 0000 0000     		.space	2
 479              		.section	.bss.adc1_cnt.2,"aw",%nobits
 480              		.align	1
 483              	adc1_cnt.2:
 484 0000 0000     		.space	2
 485              		.section	.bss.g_current,"aw",%nobits
 486              		.align	2
 489              	g_current:
 490 0000 00000000 		.space	12
 490      00000000 
 490      00000000 
 491              		.section	.bss.g_adc3_state,"aw",%nobits
 494              	g_adc3_state:
 495 0000 00       		.space	1
 496              		.section	.bss.g_adc2_state,"aw",%nobits
 499              	g_adc2_state:
 500 0000 00       		.space	1
 501              		.section	.bss.g_adc1_state,"aw",%nobits
 504              	g_adc1_state:
 505 0000 00       		.space	1
 506              		.section	.bss.g_ic,"aw",%nobits
 507              		.align	2
 510              	g_ic:
 511 0000 00000000 		.space	4
 512              		.section	.bss.g_ib,"aw",%nobits
 513              		.align	2
 516              	g_ib:
 517 0000 00000000 		.space	4
 518              		.section	.bss.g_ia,"aw",%nobits
 519              		.align	2
 522              	g_ia:
 523 0000 00000000 		.space	4
 524              		.section	.bss.g_gain,"aw",%nobits
 525              		.align	2
 528              	g_gain:
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 13


 529 0000 00000000 		.space	4
 530              		.section	.bss.g_ic_offset,"aw",%nobits
 531              		.align	2
 534              	g_ic_offset:
 535 0000 00000000 		.space	4
 536              		.section	.bss.g_ib_offset,"aw",%nobits
 537              		.align	2
 540              	g_ib_offset:
 541 0000 00000000 		.space	4
 542              		.section	.bss.g_ia_offset,"aw",%nobits
 543              		.align	2
 546              	g_ia_offset:
 547 0000 00000000 		.space	4
 548              		.text
 549              	.Letext0:
 550              		.file 2 "C:/Users/Rick/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-too
 551              		.file 3 "C:/Users/Rick/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-too
 552              		.file 4 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f446xx.h"
 553              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f4xx.h"
 554              		.file 6 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 555              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 556              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_adc.h"
 557              		.file 9 "Core/Inc/adc.h"
 558              		.file 10 "C:/Users/Rick/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-to
 559              		.file 11 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_adc_ex.h"
 560              		.file 12 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
ARM GAS  C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s 			page 14


DEFINED SYMBOLS
                            *ABS*:00000000 current.c
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:21     .text.HAL_ADCEx_InjectedConvCpltCallback:00000000 $t
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:27     .text.HAL_ADCEx_InjectedConvCpltCallback:00000000 HAL_ADCEx_InjectedConvCpltCallback
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:312    .text.HAL_ADCEx_InjectedConvCpltCallback:00000174 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:504    .bss.g_adc1_state:00000000 g_adc1_state
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:499    .bss.g_adc2_state:00000000 g_adc2_state
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:494    .bss.g_adc3_state:00000000 g_adc3_state
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:546    .bss.g_ia_offset:00000000 g_ia_offset
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:483    .bss.adc1_cnt.2:00000000 adc1_cnt.2
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:528    .bss.g_gain:00000000 g_gain
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:522    .bss.g_ia:00000000 g_ia
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:540    .bss.g_ib_offset:00000000 g_ib_offset
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:477    .bss.adc2_cnt.1:00000000 adc2_cnt.1
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:516    .bss.g_ib:00000000 g_ib
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:534    .bss.g_ic_offset:00000000 g_ic_offset
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:471    .bss.adc3_cnd.0:00000000 adc3_cnd.0
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:510    .bss.g_ic:00000000 g_ic
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:489    .bss.g_current:00000000 g_current
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:338    .text.current_init:00000000 $t
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:344    .text.current_init:00000000 current_init
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:376    .text.current_init:0000001c $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:385    .text.current_get:00000000 $t
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:391    .text.current_get:00000000 current_get
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:460    .text.current_get:0000003c $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:468    .bss.adc3_cnd.0:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:474    .bss.adc2_cnt.1:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:480    .bss.adc1_cnt.2:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:486    .bss.g_current:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:495    .bss.g_adc3_state:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:500    .bss.g_adc2_state:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:505    .bss.g_adc1_state:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:507    .bss.g_ic:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:513    .bss.g_ib:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:519    .bss.g_ia:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:525    .bss.g_gain:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:531    .bss.g_ic_offset:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:537    .bss.g_ib_offset:00000000 $d
C:\Users\Rick\AppData\Local\Temp\ccTDXgv0.s:543    .bss.g_ia_offset:00000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_TogglePin
hadc1
hadc2
hadc3
HAL_ADCEx_InjectedStart_IT
